% reviewresponse.sty

\ProvidesPackage{reviewresponse}[2025/09/18 Review response environments]

% Required packages
\RequirePackage{xifthen}
\RequirePackage{xcolor}
\RequirePackage{mdframed}
\RequirePackage{fancyhdr}
% Ensure enough space for the header (set after all packages)
\AtBeginDocument{%
  \setlength{\headheight}{14pt}% ensure enough space for header/foot
  % Make header/foot span full paper width and center content physically
  \fancyhfoffset[L]{\dimexpr -1in - \oddsidemargin\relax}
  \fancyhfoffset[R]{\dimexpr -1in - \evensidemargin\relax}
  \setlength{\headwidth}{\paperwidth}%
  % R-prefixed numbering for response letter artifacts
  \renewcommand*{\theequation}{R\arabic{equation}}
  \renewcommand*{\thefigure}{R\arabic{figure}}
  \renewcommand*{\thetable}{R\arabic{table}}
  \renewcommand*{\figurename}{Fig.}
  \renewcommand*{\tablename}{Tab.}%
}

% Reviewer (or Editor) counter (for main sections)
\newcounter{reviewer}
\renewcommand{\thereviewer}{\arabic{reviewer}}

% Per-reviewer comment counter
\newcounter{revcomment}[reviewer]
\renewcommand{\therevcomment}{\thereviewer.\arabic{revcomment}}

% Answer reference counter (mirrors current question number for labels)
\newcounter{ansref}[reviewer]
\renewcommand{\theansref}{\therevcomment}

% Reviewer section environment
\newcommand{\reviewersection}[1]{%
  \stepcounter{reviewer}%
  \setcounter{revcomment}{0}%
  \section*{#1}%
  	\thispagestyle{fancy}%
}

% Question environment (boxed, label optional)
\newenvironment{question}[1][]%
{%
  \refstepcounter{revcomment}%
  % Place label early to avoid affecting paragraph indentation
  \ifthenelse{\equal{#1}{}}{}{\label{#1}}%
  \begin{mdframed}[backgroundcolor=gray!10, linecolor=gray!60, topline=true, bottomline=true, leftline=true, rightline=true, skipabove=0pt, skipbelow=0pt]%
  \setlength{\parindent}{0pt}% no paragraph indent inside the box
  	\textbf{Question~\therevcomment:}%
  \par\noindent\ignorespaces
}
{
  \end{mdframed}
}

% Answer environment (boxed, label optional)
\newenvironment{answer}[1][]%
{%
  % Step an auxiliary counter to create a unique anchor for labels, but display revcomment
  \refstepcounter{ansref}%
  % Place label early to avoid affecting paragraph indentation
  \ifthenelse{\equal{#1}{}}{}{\label{#1}}%
  \begin{mdframed}[backgroundcolor=blue!5, linecolor=blue!30, topline=true, bottomline=true, leftline=true, rightline=true, skipabove=0pt, skipbelow=0pt]%
  \setlength{\parindent}{0pt}% no paragraph indent inside the box
  	\textbf{Answer~\therevcomment:}%
  \par\noindent\ignorespaces
}
{
  \end{mdframed}
  \vspace{1.5em}
}

% Reference command for questions/answers
\newcommand{\qref}[1]{Question~\ref{#1}}
\newcommand{\aref}[1]{Answer~\ref{#1}}

% Short reference commands for figures and tables (use current names)
\newcommand{\figref}[1]{\figurename~\ref{#1}}
\newcommand{\tabref}[1]{\tablename~\ref{#1}}
% Alias preferred name \tableref to \tabref
\newcommand{\tableref}[1]{\tabref{#1}}

% Utility: short Q/A for tight comments
\newcommand{\shortquestion}[2][]{%
  \refstepcounter{revcomment}%
  \textbf{Question~\therevcomment:}%
  \ifthenelse{\equal{#1}{}}{}{%
    \label{#1}%
  }%
  {#2}
  \par
}
\newcommand{\shortanswer}[2][]{%
  \refstepcounter{ansref}%
  	extbf{Answer~\therevcomment:}%
  \ifthenelse{\equal{#1}{}}{}{%
    \label{#1}%
  }%
  {#2}
  \par
}

\makeatletter
% Metadata commands (setters)
\newcommand{\paperid}[1]{\def\@paperid{#1}}
\newcommand{\papertitle}[2][]{\def\@papertitle{#2}\ifthenelse{\equal{#1}{}}{\def\@papertitleshort{#2}}{\def\@papertitleshort{#1}}}
\def\@paperid{}
\def\@papertitle{}
\def\@papertitleshort{}
% Public print commands (do NOT redefine in document)
\newcommand{\printpaperid}{\@paperid}
\newcommand{\printpapertitle}{\@papertitle}
\newcommand{\printpapertitleshort}{\@papertitleshort}

% Footer-only configuration (bottom center page count)
\fancyhf{} % clear all header and footer fields
\renewcommand{\headrulewidth}{0pt} % no line in header
\renewcommand{\footrulewidth}{0pt} % no line in footer
\cfoot{Page\;\thepage}
% Apply same footer for 'plain' pages (e.g., after \section*)
\fancypagestyle{plain}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
  \cfoot{Page\;\thepage}%
}
\makeatother

% End of reviewresponse.sty